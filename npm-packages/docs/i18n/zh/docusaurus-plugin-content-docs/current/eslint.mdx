---
title: ESLint è§„åˆ™
sidebar_position: 30
description: Convex çš„ ESLint è§„åˆ™
---

Convex çš„ ESLint æ’ä»¶æä¾›äº†ä¸€äº› linter è§„åˆ™ï¼Œç”¨äºåœ¨ Convex å‡½æ•°ä¸­è½å®æœ€ä½³å®è·µã€‚å¦‚æœä½ æœ‰å¸Œæœ›æ·»åŠ çš„è§„åˆ™ï¼Œè¯·å‘Šè¯‰æˆ‘ä»¬ï¼

## è®¾ç½® \{#setup\}

å¯¹äº ESLint 9ï¼ˆæ‰å¹³é…ç½®ï¼Œä½¿ç”¨ `eslint.config.js`ï¼‰ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼å®‰è£…è§„åˆ™ï¼š

```bash
npm i @convex-dev/eslint-plugin --save-dev
```

ç„¶åå°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ä½ çš„ `eslint.config.js` æ–‡ä»¶ä¸­ï¼š

```ts
import { defineConfig } from "eslint/config";

import convexPlugin from "@convex-dev/eslint-plugin";

export default defineConfig([
  // å…¶ä»–é…ç½®

  ...convexPlugin.configs.recommended,
]);
```

<Details summary={<>å¦‚æœä½ åœ¨ä½¿ç”¨å·²å¼ƒç”¨çš„ <code>.eslintrc.js</code> æ ¼å¼</>}>
  å®‰è£…ä»¥ä¸‹è¿™ä¸¤ä¸ªåº“ï¼š

  ```bash
  npm i @typescript-eslint/eslint-plugin @convex-dev/eslint-plugin --save-dev
  ```

  åœ¨ `.eslintrc.js` ä¸­æ·»åŠ ï¼š

  ```js
  module.exports =
    extends: [
      // Other configurations
      "plugin:@typescript-eslint/recommended",
      "plugin:@convex-dev/recommended",
    ],
    ignorePatterns: ["node_modules/", "dist/", "build/"],
  };
  ```
</Details>

<Details summary={<>å¦‚æœä½ çš„ Convex å‡½æ•°ä½äº <code>convex</code> ç›®å½•ä¹‹å¤–</>}>
  é»˜è®¤æƒ…å†µä¸‹ï¼ŒConvex ESLint æ’ä»¶åªä¼šåœ¨ `convex` ç›®å½•ä¸­åº”ç”¨è§„åˆ™ã€‚

  å¦‚æœä½ æ­£åœ¨
  [è‡ªå®šä¹‰ Convex ç›®å½•ä½ç½®](/production/project-configuration#changing-the-convex-folder-name-or-location)ï¼Œ
  å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è°ƒæ•´ä½ çš„ ESLint é…ç½®ï¼š

  ```ts
  // eslint.config.js
  import { defineConfig } from "eslint/config";

  import convexPlugin from "@convex-dev/eslint-plugin";

  const recommendedConfig = convexPlugin.configs.recommended[0];
  const recommendedRules = recommendedConfig.rules;

  export default defineConfig([
    // Other configurations go here...

    // Custom configuration with modified directory pattern
    {
      files: ["**/src/convex/**/*.ts"],
      plugins: {
        "@convex-dev": convexPlugin,
      },
      rules: recommendedRules,
    },
  ]);
  ```
</Details>

<Details summary={<>å¦‚æœä½ åœ¨ Next.js ä¸­ä½¿ç”¨ <code>next lint</code> å‘½ä»¤</>}>
  ä¸ºäº†è®© `next lint` åœ¨ä½ çš„ `convex` ç›®å½•ä¸Šè¿è¡Œ ESLintï¼Œä½ éœ€è¦æŠŠè¯¥ç›®å½•
  æ·»åŠ åˆ°é»˜è®¤çš„ç›®å½•åˆ—è¡¨ä¸­ã€‚å°†ä¸‹é¢è¿™ä¸€æ®µæ·»åŠ åˆ°ä½ çš„ `next.config.ts` ä¸­ï¼š

  ```ts
  const nextConfig: NextConfig = {
    /* other options here */

    eslint: {
      dirs: ["pages", "app", "components", "lib", "src", "convex"],
    },
  };
  ```
</Details>

## è§„åˆ™ \{#rules\}

| è§„åˆ™                                                                                                                                    | æ¨èå¼€å¯ | å¯è‡ªåŠ¨ä¿®å¤ |
| --------------------------------------------------------------------------------------------------------------------------------------- | :------: | :--------: |
| [`@convex-dev/no-old-registered-function-syntax`](#no-old-registered-function-syntax)<br />æ³¨å†Œå‡½æ•°æ—¶ä¼˜å…ˆä½¿ç”¨å¯¹è±¡è¯­æ³•                     |    âœ…    |     ğŸ”§     |
| [`@convex-dev/require-argument-validators`](#require-argument-validators)<br />è¦æ±‚ä¸º Convex å‡½æ•°çš„å‚æ•°æä¾›å‚æ•°æ ¡éªŒå™¨                     |    âœ…    |     ğŸ”§     |
| [`@convex-dev/explicit-table-ids`](#explicit-table-ids)<br />åœ¨æ•°æ®åº“æ“ä½œä¸­è¦æ±‚æ˜¾å¼æŒ‡å®šè¡¨å                                              |    âœ…    |     ğŸ”§     |
| [`@convex-dev/import-wrong-runtime`](#import-wrong-runtime)<br />ç¦æ­¢ Convex è¿è¡Œæ—¶æ–‡ä»¶ä» Node è¿è¡Œæ—¶æ–‡ä»¶ä¸­å¯¼å…¥                          |          |            |

### no-old-registered-function-syntax \{#no-old-registered-function-syntax\}

ä¸ºæ³¨å†Œå‡½æ•°ä¼˜å…ˆä½¿ç”¨å¯¹è±¡è¯­æ³•ã€‚

Convex æŸ¥è¯¢ã€å˜æ›´å‡½æ•°å’Œæ“ä½œå‡½æ•°å¯ä»¥ç”¨å•ä¸ªå‡½æ•°æ¥å®šä¹‰ï¼Œ
ä¹Ÿå¯ä»¥ä½¿ç”¨åŒ…å« `handler` å±æ€§çš„å¯¹è±¡æ¥å®šä¹‰ã€‚ä½¿ç”¨å¯¹è±¡å½¢å¼å¯ä»¥
æ·»åŠ å‚æ•°å’Œè¿”å›å€¼çš„éªŒè¯å™¨ï¼Œå› æ­¤æ€»æ˜¯æ›´æ¨èä½¿ç”¨è¿™ç§å†™æ³•ã€‚

```ts
// âœ… Allowed by this rule:
export const list = query({
  handler: async (ctx) => {
    const data = await ctx.db.query("messages").collect();
    ...
  },
});

// âŒ æ­¤è§„åˆ™ä¸å…è®¸:
export const list = query(async (ctx) => {
  const data = await ctx.db.query("messages").collect();
  ...
});
```

### require-argument-validators \{#require-argument-validators\}

è¦æ±‚ Convex å‡½æ•°å¿…é¡»ä½¿ç”¨å‚æ•°æ ¡éªŒå™¨ã€‚

Convex æŸ¥è¯¢ã€å˜æ›´å‡½æ•°å’Œæ“ä½œå‡½æ•°å¯ä»¥åœ¨å¤„ç†å‡½æ•°å¼€å§‹æ‰§è¡Œä¹‹å‰å¯¹å‚æ•°è¿›è¡Œæ ¡éªŒã€‚é™¤äº†æ˜¯ä¸€ç§ç®€æ´çš„æ–¹å¼æ¥æ ¡éªŒå‚æ•°ç±»å‹ä¹‹å¤–ï¼Œä½¿ç”¨å‚æ•°æ ¡éªŒå™¨è¿˜èƒ½ç”Ÿæˆæ›´å…·æè¿°æ€§çš„å‡½æ•°è§„æ ¼è¯´æ˜ï¼Œä»è€Œç”Ÿæˆ OpenAPI ç»‘å®šã€‚

```ts
// âœ… Allowed by this rule:
export const list = query({
  args: {},
  handler: async (ctx) => {
    ...
  },
});

// âœ… Allowed by this rule:
export const list = query({
  args: { channel: v.id('channel') },
  handler: async (ctx, { channel }) => {
    ...
  },
});

// âŒ é€‰é¡¹ { ignoreUnusedArguments: false }(é»˜è®¤)ä¸å…è®¸
// âœ… é€‰é¡¹ { ignoreUnusedArguments: true } å…è®¸
export const list = query({
  handler: async (ctx) => {
    ...
  },
});

// âŒ Not allowed by this rule:
export const list = query({
  handler: async (ctx, { channel }: { channel: Id<"channel"> }) => {
    ...
  },
});
```

æ­¤è§„åˆ™å¯ä»¥é…ç½®ä¸ºå…è®¸é‚£äº›æ—¢æ²¡æœ‰å®šä¹‰å‚æ•°éªŒè¯å™¨ã€ä¹Ÿä¸ä½¿ç”¨å…¶å‚æ•°çš„å‡½æ•°ã€‚ä½ å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è®¾ç½®æ­¤è§„åˆ™ï¼š

```ts
// eslint.config.js

export default defineConfig([
  // ä½ çš„å…¶ä»–è§„åˆ™â€¦

  {
    files: ["**/convex/**/*.ts"],
    rules: {
      "@convex-dev/require-args-validator": [
        "error",
        {
          ignoreUnusedArguments: true,
        },
      ],
    },
  },
]);
```

### explicit-table-ids \{#explicit-table-ids\}

åœ¨æ•°æ®åº“æ“ä½œä¸­å¼ºåˆ¶æ˜¾å¼æŒ‡å®šè¡¨åã€‚

ä» `convex` npm åŒ…çš„ 1.31.0 ç‰ˆæœ¬å¼€å§‹ï¼Œæˆ‘ä»¬å»ºè®®åœ¨æ•°æ®åº“æ“ä½œï¼ˆ`db.get`ã€`db.replace`ã€`db.patch`ã€`db.delete`ï¼‰ä¸­ï¼Œå°†è¡¨åä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ã€‚

è¿™ç§æ–¹å¼æ›´å®‰å…¨ï¼Œå› ä¸ºå®ƒå¯ä»¥é˜²æ­¢å‡ºç°å°†æŸä¸ªè¡¨çš„ ID è¯¯å½“ä½œå¦ä¸€ä¸ªè¡¨çš„ ID ä½¿ç”¨è€Œå¯¼è‡´çš„æ¼æ´ã€‚éšå¼è¯­æ³•ï¼ˆå³ä» ID æ¨æ–­è¡¨åï¼‰å°†åœ¨æœªæ¥è¢«å¼ƒç”¨ï¼Œä»¥ä¾¿è®©å¼€å‘è€…å¯¹ ID çš„ç”Ÿæˆæ‹¥æœ‰æ›´å¤šæ§åˆ¶æƒã€‚åŸºäºè¿™ä¸¤ä¸ªåŸå› ï¼Œæˆ‘ä»¬å»ºè®®å¼€å‘è€…è¿ç§»åˆ°æ–°çš„æ ¼å¼ã€‚

æ­¤è§„åˆ™æœ‰åŠ©äºå°†ä»£ç ä»æ—§çš„éšå¼æ ¼å¼è¿ç§»åˆ°æ–°çš„æ˜¾å¼æ ¼å¼ã€‚å®ƒä½¿ç”¨ TypeScript çš„ç±»å‹ä¿¡æ¯ï¼Œä» `Id<"tableName">` ç±»å‹ä¸­è‡ªåŠ¨æ¨æ–­è¡¨åï¼Œå¹¶æä¾›è‡ªåŠ¨ä¿®å¤åŠŸèƒ½ã€‚

```ts
const messageId: Id<"messages"> = "123" as Id<"messages">;

// âœ… Allowed by this rule:
const message = await ctx.db.get("messages", messageId);
await ctx.db.patch("messages", messageId, { text: "updated" });
await ctx.db.replace("messages", messageId, {
  text: "replaced",
  author: "Alice",
});
await ctx.db.delete("messages", messageId);

// âŒ æ­¤è§„åˆ™ä¸å…è®¸:
const message = await ctx.db.get(messageId);
await ctx.db.patch(messageId, { text: "updated" });
await ctx.db.replace(messageId, { text: "replaced", author: "Alice" });
await ctx.db.delete(messageId);
```

<Admonition type="info" title="éœ€è¦ typescript-eslint">
  è¦ä½¿æ­¤è§„åˆ™ç”Ÿæ•ˆï¼Œå¿…é¡»åœ¨ä½ çš„ ESLint é…ç½®ä¸­æ­£ç¡®é…ç½®
  [typescript-eslint](https://typescript-eslint.io)ã€‚å¦‚æœå·²ç»å®‰è£…äº†
  typescript-eslintï¼Œä½†è§„åˆ™ä¼¼ä¹ä¸èµ·ä½œç”¨ï¼Œè¯·ç¡®ä¿å·²å¯ç”¨
  [type-aware linting](https://typescript-eslint.io/troubleshooting/typed-linting/)ã€‚
</Admonition>

è¯·æ³¨æ„ï¼Œå¦‚æœä½ æœªä½¿ç”¨ ESLintï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `@convex-dev/codemod` CLI å·¥å…·è‡ªåŠ¨è¿ç§»åˆ°æ–°æ ¼å¼ï¼š

```bash
npx @convex-dev/codemod@latest explicit-ids
```

[åœ¨ news.convex.dev é˜…è¯»è¯¦æƒ… â†’](https://news.convex.dev/db-table-name/)

### import-wrong-runtime \{#import-wrong-runtime\}

é˜²æ­¢ Convex è¿è¡Œæ—¶æ–‡ä»¶ä» Node è¿è¡Œæ—¶æ–‡ä»¶ï¼ˆåŒ…å« `"use node"` æŒ‡ä»¤çš„æ–‡ä»¶ï¼‰ä¸­å¯¼å…¥å†…å®¹ã€‚

æ­¤è§„åˆ™ç›®å‰ä¸ºå®éªŒæ€§åŠŸèƒ½ã€‚å¦‚æœä½ è§‰å¾—å®ƒæœ‰ç”¨ï¼Œè¯·å‘Šè¯‰æˆ‘ä»¬ï¼

```ts
// åœ¨ä¸ä½¿ç”¨ `"use node"` çš„æ–‡ä»¶ä¸­:

// âœ… æ­¤è§„åˆ™å…è®¸:
import { someFunction } from "./someOtherFile"; // å…¶ä¸­ someOtherFile ä¸ä½¿ç”¨ `"use node"`

// âŒ æ­¤è§„åˆ™ä¸å…è®¸:
import { someFunction } from "./someNodeFile"; // å…¶ä¸­ someNodeFile ä½¿ç”¨ `"use node"`
```
