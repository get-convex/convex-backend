---
title: "バックアップと復元"
sidebar_position: 85
description: "Convex のデータとファイルをバックアップおよび復元する"
---

Convex では、[ダッシュボード](https://dashboard.convex.dev/deployment/settings/backups)からデータのバックアップと復元を行えます。

![Backups Page](/screenshots/backups.png)

# バックアップ \{#backups\}

バックアップは、リクエスト時点で作成されるテーブルデータの整合性の取れたスナップショットです。バックアップにはファイルストレージを含めるように設定できます。

「Backup Now」ボタンをクリックして手動バックアップを実行します。デプロイメントに含まれるデータ量に応じて、数秒から数時間かかる場合があります。

手動バックアップは 7 日間保存されます。このページからバックアップをダウンロードまたは削除できます。

デプロイメントの設定やその他のデータ（コード、環境変数、スケジュールされた関数など）は含まれません。

### 定期バックアップ \{#periodic-backups\}

「Backup automatically」チェックボックスをオンにして、毎日または毎週の定期バックアップをスケジュールできます。バックアップを実行する時刻や曜日、ファイルストレージを含めるかどうかを選択できます。

毎日のバックアップは 7 日間保存されます。毎週のバックアップは 14 日間保存されます。

<ProFeatureUpsell feature="定期バックアップ" verb="require" />

### バックアップからの復元 \{#restoring-from-backup\}

個々のバックアップのサブメニューから「Restore」を選択して、バックアップから復元します。バックアップページのデプロイメントセレクターを使うことで、同じデプロイメントのバックアップだけでなく、同じチーム内の他のデプロイメントのバックアップからも復元できます。復元には、バックアップ内のデータ量に応じて数秒から数時間かかる場合があります。

復元は、既存のデータをすべて消去し、バックアップ内のデータで置き換える破壊的な操作であることに注意してください。復元を行う前に、追加のバックアップを作成することを推奨します。

バックアップから復元する際、デプロイメント内にすでに存在するファイルは削除されませんが、バックアップ内に含まれていて現在デプロイメント内に存在しないファイルは、デプロイメントにアップロードされます。

### 緊急時のリストア \{#restoring-in-an-emergency\}

本番デプロイメントが望ましくない状態になってしまった場合、正常な状態に戻すために
リストアを実行することを検討してください。なお、データを正常な状態に戻すだけでは
十分でない可能性があります。以下の各アクションが必要かどうかを検討してください。
緊急事態の内容によっては、これらが必須となる場合があります。

* リストアは破壊的な操作であるため、その前に追加のバックアップを取得する
* データを復元するために、正常なバックアップからリストアを実行する
* `npx convex dev` を使って、既知の正常なバージョンのコードをプッシュする
* `npx convex env` またはダッシュボードを使って、正常な環境変数のセットに戻す
* ダッシュボードを使って、アプリのデータベースに対して手動の修正を行う
* アプリのデータベースに必要な（よりプログラム的な）手動修正を行うための
  ミューテーションを実装する

# バックアップのダウンロード \{#downloading-a-backup\}

ダッシュボードのメニューにあるダウンロードボタンから、手動バックアップと定期バックアップをダウンロードできます。

あるいは、同じ形式のエクスポートを
[コマンドラインインターフェイス（CLI）](/cli.md#export-data-to-a-file)
から生成することもできます。

```sh
npx convex export --path ~/Downloads
```

バックアップは、デプロイメント内のすべての Convex テーブルにあるすべてのドキュメントを含む ZIP ファイルとして生成されます。

ZIP ファイル名の形式は `snapshot_{ts}.zip` で、`ts` はスナップショット時刻を表すナノ秒単位の UNIX タイムスタンプです。エクスポートされた ZIP ファイルには、各テーブルのドキュメントが `<table_name>/documents.jsonl` に含まれ、1 行につき 1 件のドキュメントが格納されています。

[file storage](/file-storage) を含むエクスポート ZIP ファイルには、`_storage` フォルダ内にストレージデータが含まれ、ID やチェックサムなどのメタデータは `_storage/documents.jsonl` にあり、各ファイルは `_storage/<id>` として保存されます。

### ダウンロードしたバックアップの利用 \{#using-the-downloaded-backup\}

ダウンロードした ZIP ファイルは、同じデプロイメントまたは別のデプロイメントに対して
[CLI を使って](/database/import-export/import.mdx#restore-data-from-a-backup-zip-file)インポートできます。

## FAQ（よくあるご質問） \{#faq\}

### 制限はありますか？ \{#are-there-any-limitations\}

各バックアップには最大 7 日間アクセスできます。

Free/Starter プランでは、1 つのデプロイメントあたり同時に最大 2 つのバックアップを保存できます。
Convex Professional プランのデプロイメントでは、通常どおりの従量課金制で複数のバックアップを保持できます。

### 料金体系はどうなっていますか？ \{#how-are-they-priced\}

バックアップは、すべてのドキュメントを読み出すためにデータベース帯域幅を使用し、ユーザーファイルを含めるためにファイル帯域幅を使用します。バックアップデータ自体の生成と保存は、ユーザーファイルストレージと同じ帯域幅およびストレージの料金体系で課金されます。これらの帯域幅とストレージのコストは
[使用状況ダッシュボード](https://dashboard.convex.dev/team/settings/usage)
で確認できます。料金の詳細については
[制限に関するドキュメント](/production/state/limits#database)
を参照してください。

### バックアップに含まれないものは何ですか？ \{#what-does-the-backup-not-contain\}

バックアップに含まれるのは、テーブルのドキュメントとファイルストレージ内のファイルのみです。特に、次のものは含まれません。

1. デプロイメントのコードと設定。Convex 関数、crons.ts、auth.config.js、schema.ts などは、ソースコード内で設定されます。
2. 保留中のスケジュール関数。保留中のスケジュール関数は、[`_scheduled_functions`](/database/advanced/system-tables.mdx) システムテーブルで確認できます。
3. 環境変数。環境変数は Convex ダッシュボードの Settings からコピーできます。